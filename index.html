<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è–‡è–‡å®‰çš„è³‡ç”¢åœ“é¤…åœ–</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f4f5f7; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        
        h1 { color: #2c3e50; text-align: center; margin-bottom: 5px; font-size: 1.5rem; }
        .subtitle { text-align: center; color: #7f8c8d; font-size: 0.9rem; margin-bottom: 30px; }

        /* è¼¸å…¥å€å¡Šæ¨£å¼ */
        .section-title { font-weight: bold; margin-top: 25px; margin-bottom: 10px; color: #34495e; border-left: 4px solid #FF6B6B; padding-left: 10px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .input-group { background: #f8f9fa; padding: 12px; border-radius: 12px; border: 1px solid #edf2f7; }
        .input-group label { display: block; font-size: 0.8rem; color: #666; margin-bottom: 5px; }
        .input-group input { width: 90%; padding: 5px; border: none; background: transparent; font-size: 1.1rem; font-weight: bold; color: #2d3436; outline: none; }
        .input-group input:focus { border-bottom: 2px solid #FF6B6B; }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn { display: block; width: 100%; padding: 15px; background: linear-gradient(135deg, #FF6B6B, #FF8E53); color: white; border: none; border-radius: 50px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 30px; box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4); transition: transform 0.1s; }
        .btn:active { transform: scale(0.98); }

        /* çµæœé¡¯ç¤ºå€ */
        .result-card { background: #fff; border-radius: 15px; margin-top: 30px; padding: 20px; text-align: center; border: 1px solid #eee; }
        .big-number { font-size: 2.5rem; font-weight: 800; color: #27ae60; margin: 10px 0; }
        .future-badge { display: inline-block; background: #e8f5e9; color: #2e7d32; padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; margin-top: 10px; }

        /* åœ“é¤…åœ–å®¹å™¨ */
        .chart-container { position: relative; height: 300px; width: 100%; margin-top: 20px; }
        
        /* å‹¾é¸æ¡†ç¾åŒ– */
        .checkbox-wrapper { margin-top: 20px; background: #e3f2fd; padding: 15px; border-radius: 10px; display: flex; align-items: center; }
        .checkbox-wrapper input { width: 20px; height: 20px; margin-right: 10px; cursor: pointer; }
        .checkbox-wrapper label { cursor: pointer; color: #1565c0; font-weight: bold; font-size: 0.95rem; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ’ è–‡è–‡å®‰çš„è³‡ç”¢åœ“é¤…åœ–</h1>
    <p class="subtitle">è³‡ç”¢é…ç½® & æœªä¾†è²¡å¯Œé æ¸¬</p>

    <div class="grid">
        <div class="input-group">
            <label>ğŸ‡ºğŸ‡¸ ç¾é‡‘åŒ¯ç‡</label>
            <input type="number" id="usd_rate" value="32.5" step="0.1">
        </div>
        <div class="input-group">
            <label>ğŸ“ˆ é ä¼°å¹´å ±é…¬ (%)</label>
            <input type="number" id="growth_rate" value="6.0" step="0.5">
        </div>
    </div>

    <div class="section-title">1. è‚¡ç¥¨èˆ‡åŸºé‡‘ (å¡«å°å¹£å¸‚å€¼)</div>
    <div class="grid">
        <div class="input-group">
            <label>0050 å¸‚å€¼</label>
            <input type="number" id="stock_0050" value="2961">
        </div>
        <div class="input-group">
            <label>QQQM å¸‚å€¼</label>
            <input type="number" id="stock_qqqm" value="0">
        </div>
        <div class="input-group">
            <label>VTI å¸‚å€¼</label>
            <input type="number" id="stock_vti" value="5058">
        </div>
        <div class="input-group">
            <label>è‡ªé¸å°è‚¡åˆè¨ˆ</label>
            <input type="number" id="stock_custom" value="0">
        </div>
    </div>

    <div class="section-title">2. ç¾é‡‘ & éš±è—è³‡ç”¢</div>
    <div class="grid">
        <div class="input-group">
            <label>ğŸ’° éŠ€è¡Œç¸½é¤˜é¡ (å…¨éƒ¨)</label>
            <input type="number" id="cash_total" value="1369541">
        </div>
        <div class="input-group">
            <label>ğŸ“¦ ä¿å–® + å›¤è²¨åƒ¹å€¼</label>
            <input type="number" id="other_assets" value="0">
        </div>
    </div>
    <div class="input-group" style="margin-top: 15px; border-color: #ffcdd2; background: #fff5f5;">
        <label style="color: #c62828;">ğŸš« æš«å­˜å…¬æ¬¾ (ä¸å±¬æ–¼å¦³çš„éŒ¢)</label>
        <input type="number" id="client_funds" value="0" style="color: #c62828;">
    </div>

    <div class="section-title">3. è² å‚µç®¡ç†</div>
    <div class="grid">
        <div class="input-group">
            <label>ä¿¡è²¸å‰©é¤˜æœ¬é‡‘</label>
            <input type="number" id="debt" value="1950000">
        </div>
        <div class="input-group">
            <label>æ¯æœˆé‚„æ¬¾é‡‘é¡</label>
            <input type="number" id="monthly_pay" value="26550" readonly>
        </div>
    </div>

    <div class="checkbox-wrapper">
        <input type="checkbox" id="pay_from_salary" checked>
        <label for="pay_from_salary">âœ… æˆ‘æ˜¯ç”¨ã€Œè–ªæ°´ã€æ”¯ä»˜è²¸æ¬¾èˆ‡æŠ•è³‡<br><span style="font-size:0.8em; font-weight:normal; color:#555;">(å‹¾é¸å¾Œï¼Œç¾æœ‰å­˜æ¬¾ä¸æœƒè¢«æ‰£é™¤ï¼Œè³‡ç”¢æˆé•·æœ€æº–ç¢º)</span></label>
    </div>

    <button class="btn" onclick="calculate()">ğŸ”„ æ›´æ–°åœ“é¤…åœ–èˆ‡é æ¸¬</button>

    <div class="chart-container">
        <canvas id="assetPieChart"></canvas>
    </div>

    <div class="result-card">
        <p style="color: #666; margin:0;">å¦³ç›®å‰çš„æ·¨è³‡ç”¢ (èº«åƒ¹)</p>
        <div class="big-number" id="net_worth_display">$0</div>
        
        <hr style="border: 0; border-top: 1px dashed #ddd; margin: 20px 0;">

        <p style="font-weight: bold; color: #333;">ğŸ”® ä¸€å¹´å¾Œçš„è²¡å¯Œé æ¸¬</p>
        <div class="future-badge" id="future_net_worth">$0</div>
        <div style="margin-top: 10px; color: #e67e22; font-weight: bold;" id="wealth_change"></div>
    </div>

</div>

<script>
    let myPieChart = null;

    function calculate() {
        // 1. æŠ“å–æ•¸å€¼
        let rate = parseFloat(document.getElementById('usd_rate').value) || 32.5;
        let growth = parseFloat(document.getElementById('growth_rate').value) || 6;
        
        let s1 = parseFloat(document.getElementById('stock_0050').value) || 0;
        let s2 = parseFloat(document.getElementById('stock_qqqm').value) || 0;
        let s3 = parseFloat(document.getElementById('stock_vti').value) || 0;
        let s4 = parseFloat(document.getElementById('stock_custom').value) || 0;
        
        let cash = parseFloat(document.getElementById('cash_total').value) || 0;
        let other = parseFloat(document.getElementById('other_assets').value) || 0;
        let client = parseFloat(document.getElementById('client_funds').value) || 0;
        
        let debt = parseFloat(document.getElementById('debt').value) || 0;
        let monthly = 26550;

        // 2. è¨ˆç®—ç›®å‰è³‡ç”¢
        let stock_total = s1 + s2 + s3 + s4;
        let real_cash = cash - client; // æ‰£æ‰å…¬æ¬¾
        let total_assets = stock_total + real_cash + other;
        let net_worth = total_assets - debt;

        // 3. æ›´æ–°é¡¯ç¤ºæ•¸å­—
        document.getElementById('net_worth_display').innerText = "$" + net_worth.toLocaleString('zh-TW', {maximumFractionDigits: 0});

        // 4. æ›´æ–°åœ“é¤…åœ–
        updateChart(stock_total, real_cash, other);

        // 5. è¨ˆç®—ä¸€å¹´å¾Œé æ¸¬
        // è‚¡ç¥¨æˆé•·
        let future_stock_old = stock_total * (1 + growth/100);
        let monthly_invest_vti = 160 * rate; 
        
        // å‡è¨­VTIå®šæœŸå®šé¡ä¹Ÿæ˜¯å¾è–ªæ°´æ‰£ (å¦‚æœä¸å‹¾é¸å‰‡æ˜¯å¾å­˜æ¬¾æ‰£)
        let payFromSalary = document.getElementById('pay_from_salary').checked;
        let future_stock_new = (monthly_invest_vti * 12) * (1 + growth/100/2);
        let future_stock_total = future_stock_old + future_stock_new;

        // è² å‚µæ¸›å°‘
        let yearly_pay = monthly * 12;
        let interest = debt * 0.035; 
        let principal_paid = yearly_pay - interest;
        let future_debt = debt - principal_paid;

        // ç¾é‡‘è®ŠåŒ– (é—œéµé‚è¼¯)
        let future_cash = real_cash; 
        if (!payFromSalary) {
            // å¦‚æœä¸æ˜¯ç”¨è–ªæ°´ä»˜ï¼Œå°±è¦æ‰£å­˜æ¬¾
            let cash_out = yearly_pay + (monthly_invest_vti * 12);
            future_cash = real_cash - cash_out;
        }

        // æœªä¾†æ·¨å€¼
        let future_assets = future_stock_total + future_cash + other;
        let future_net = future_assets - future_debt;
        let diff = future_net - net_worth;

        document.getElementById('future_net_worth').innerText = "é ä¼°æ·¨å€¼: $" + future_net.toLocaleString('zh-TW', {maximumFractionDigits: 0});
        let sign = diff >= 0 ? "+" : "";
        document.getElementById('wealth_change').innerText = "è³‡ç”¢å¢åŠ : " + sign + "$" + diff.toLocaleString('zh-TW', {maximumFractionDigits: 0});
        
        saveData();
    }

    // ç•«åœ“é¤…åœ–çš„å‡½å¼
    function updateChart(stock, cash, other) {
        const ctx = document.getElementById('assetPieChart').getContext('2d');
        
        if (myPieChart) {
            myPieChart.destroy(); // å¦‚æœåœ–è¡¨å·²å­˜åœ¨ï¼Œå…ˆåˆªé™¤èˆŠçš„
        }

        myPieChart = new Chart(ctx, {
            type: 'doughnut', // ç”œç”œåœˆåœ– (Percento é¢¨æ ¼)
            data: {
                labels: ['è‚¡ç¥¨èˆ‡åŸºé‡‘', 'ç¾é‡‘ (æ‰£å…¬æ¬¾)', 'ä¿å–®èˆ‡å›¤è²¨'],
                datasets: [{
                    data: [stock, cash, other],
                    backgroundColor: [
                        '#FF6B6B', // ç´…è‰²ç³» (è‚¡ç¥¨)
                        '#4ECDC4', // é’è‰²ç³» (ç¾é‡‘)
                        '#FFE66D'  // é»ƒè‰²ç³» (å…¶ä»–)
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { font: { size: 14 } }
                    },
                    title: {
                        display: true,
                        text: 'ç›®å‰è³‡ç”¢é…ç½®',
                        font: { size: 16 }
                    }
                }
            }
        });
    }

    function saveData() {
        const inputs = document.querySelectorAll('input');
        inputs.forEach(input => {
            if(input.type === 'checkbox') localStorage.setItem(input.id, input.checked);
            else localStorage.setItem(input.id, input.value);
        });
    }

    function loadData() {
        const inputs = document.querySelectorAll('input');
        inputs.forEach(input => {
            const val = localStorage.getItem(input.id);
            if (val !== null) {
                if(input.type === 'checkbox') input.checked = (val === 'true');
                else input.value = val;
            }
        });
        calculate();
    }

    window.onload = loadData;
</script>

</body>
</html>
